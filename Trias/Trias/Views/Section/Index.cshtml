@{
    ViewBag.Title = "添加剖面";
}
@model Trias.Models.Section
@*模态框*@
<div id="dd" class="easyui-dialog" title="My Dialog" style="width: 400px; height: 200px;"
    data-options="iconCls:'icon-save',resizable:true,modal:true,closed:true">
    Dialog Content.    
</div>
<div style="margin: 10px;">
    <form id="form" method="post">
        <h2>添加剖面</h2>
        核准人：
        <input name="Authorizer" id="Authorizer" type="text" readonly="readonly" /><font color="red">*</font><br />
        <br />
        核准时间：<input class="easyui-datebox" name="EnterTime" id="EnterTime" type="text" /><font color="red">*</font><br />
        <br />
        剖面名称：<input name="SectionName" id="SectionName" type="text" /><font color="red">*</font><br />
        <br />
        参考文献：<input name="RID1" id="RID1" type="text" value="@ViewBag.R_ID" readonly="readonly" onclick="openDialog(1)"/><font color="red">*</font>
        <input name="RID2" id="RID2" type="text" readonly="readonly" onclick="openDialog(2)" />
        <input name="RID3" id="RID3" type="text" readonly="readonly" onclick="openDialog(3)" /><br />
        <br />
        时代：<input name="Time2" id="Time2" type="text" />百万年<br />
        <br />
        时代：
        <select name="Time" id="Time" onchange="change()">
        </select>
        <select name="SubTime" id="SubTime">
        </select>
        <br />
        <br />
        国家：<input name="Country" id="Country" type="text" /><font color="red">*</font>
        省份：<input name="Province" id="Province" type="text" /><font color="red">*</font>
        城市：<input name="City" id="City" type="text" /><font color="red">*</font>
        县/区：<input name="County" id="County" type="text" />
        村：<input name="Village" id="Village" type="text" /><br />
        <br />
        度，分，秒<br />
        <br />
        经度：<input name="LonDegrees" id="LonDegrees" type="text" />° 
        <input name="LonMinutes" id="LonMinutes" type="text" />' 
        <input name="LonSeconds" id="LonSeconds" type="text" />"<select name="lon" id="lon">
            <option value="Arabic">北纬</option>
            <option value="Arabic">南纬</option>
        </select><select name="GetLocation" id="GetLocation">
            <option value="Province">省份</option>
            <option value="City">城市</option>
            <option value="County">县/区</option>
            <option value="Village">村</option>
        </select>
        <br />
        <br />
        纬度：<input name="LatDegrees" id="LatDegrees" type="text" />° 
        <input name="LatMinutes" id="LatMinutes" type="text" />' 
        <input name="LatSeconds" id="LatSeconds" type="text" />"<select name="lat" id="lat">
            <option value="Arabic">东经</option>
            <option value="Arabic">西经</option>
        </select>
        <a class="easyui-linkbutton" onclick="GetGPS()">获取GPS值</a><font color="red">*</font><br />
        <br />
        海拔：<input name="Altitude" id="Altitude" type="text" /><select name="measure" id="measure">
            <option value="Arabic">米</option>
            <option value="Arabic">英寸</option>
        </select><br />
        <br />

        构造板块：<input name="TectonicPlate" id="TectonicPlate" type="text" /><br />
        <br />
        注释：<input name="Notes" id="Notes" type="text" /><br />
        <br />
        评论：<textarea name="Comments" id="Comments"></textarea><br />
        <br />
        <a class="easyui-linkbutton" onclick="reset()">重置</a>
        <a class="easyui-linkbutton" onclick="save()">保存</a>
        <a class="easyui-linkbutton" id="addFormation" onclick="addFormation()">添加岩石组</a>
    </form>
</div>
<script>
    function change() {
        //处理时代子元素下拉框
        $.post("/Dict/GetSelectOptions", { type: "SubTime", pid: $("#Time>option:selected").attr("id") }, function (result) {
            $("#SubTime").html("");
            for (var i = 0; i < result.length; i++) {
                var value = result[i].KeyName;
                var text = result[i].ValueName;
                $("#SubTime").append("<option value='" + value + "'>" + text + "</option>");
            }
        }, "json");
    }
    function GetGPS() {
        var value = $("#GetLocation").val();
        var text = $("#" + value).val()
        $.post("/Baidu/Index", { id: text }, function (result) {
            console.log(result);
        }, "json");
    }
    function openDialog(re) {//打开参考文献模态框
        $('#dd').dialog("open");
    }
    function init() {
        $("#Authorizer").val(currentUser.UserName);//获取核准人
    }

    $(function () {
        $('#addFormation').linkbutton('disable');//禁用button
        //获取当前日期
        var currentDate = new Date();
        $('#EnterTime').datebox('setValue', (currentDate.getMonth + 1) + "/" + currentDate.getDate() + "/" + currentDate.getYear());
        //处理时代下拉框
        $.post("/Dict/GetSelectOptions", { type: "Time" }, function (result) {
            $("#Time").html("");
            for (var i = 0; i < result.length; i++) {
                var value = result[i].KeyName;
                var text = result[i].ValueName;
                $("#Time").append("<option id='"+result[i].Id+"' value='" + value + "'>" + text + "</option>");
            }
            change();

        }, "json");
        //表单操作
        $('#form').form({
            url: '/Section/Add',
            onSubmit: function () {
                //提交验证，return false;不提交
            },
            success: function (data) {
                //提交成功后的操作
                //提交成功后的操作
                if (typeof data == "string") {
                    data = $.parseJSON(data);
                }
                if (data.status == "success") {
                    rid = data.msg.R_ID;
                    $('#addFormation').linkbutton('enable');//启用button
                    $.messager.alert("", "保存成功！", "info");
                }
                else {
                    $.messager.alert("", data.msg, "warning");
                }
            }
        });
    });
    function reset() {
        $.messager.alert("", "重置完成！", "info");
        $('#form').form("reset");
    }
    function save() {

        $('#form').form("submit");
    }
    function Formation() {

    }
</script>

